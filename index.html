<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö KDC ÎèÑÏÑúÍ¥Ä ÎπôÍ≥† Í≤åÏûÑ - 2025 ÏÇ¨ÎåÄÎèÑÌòë ÏÇ¨Î¨¥Íµ≠</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1a202c;
            line-height: 1.6;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 1rem;
        }

        .container-wide {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            padding: 2rem 0 1rem;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        /* Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1.25rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            min-height: 44px;
            user-select: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:not(:disabled):hover {
            transform: translateY(-1px);
        }

        .btn:not(:disabled):active {
            transform: translateY(0);
        }

        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover:not(:disabled) { background: #2563eb; }

        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover:not(:disabled) { background: #dc2626; }

        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover:not(:disabled) { background: #d97706; }

        .btn-success { background: #10b981; color: white; }
        .btn-success:hover:not(:disabled) { background: #059669; }

        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover:not(:disabled) { background: #4b5563; }

        .btn-small {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            min-height: 36px;
        }

        .btn-full {
            width: 100%;
        }

        /* ÏûÖÎ†• ÌïÑÎìú */
        .input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            background: white;
            transition: border-color 0.2s ease;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ÏÉÅÌÉú ÌëúÏãú */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-online {
            background: rgba(16, 185, 129, 0.2);
            color: #065f46;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-offline {
            background: rgba(239, 68, 68, 0.2);
            color: #991b1b;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Î£∏ Ï†ïÎ≥¥ */
        .room-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .room-code {
            font-family: 'SF Mono', monospace;
            font-weight: 700;
            background: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin: 0 0.25rem;
            border: 1px solid #e2e8f0;
        }

        /* ÌÜµÍ≥Ñ Í∑∏Î¶¨Îìú */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .stat-number {
            font-size: 1.875rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.8;
            font-weight: 600;
        }

        .stat-blue { color: #3b82f6; }
        .stat-green { color: #10b981; }
        .stat-purple { color: #8b5cf6; }
        .stat-orange { color: #f59e0b; }

        /* ÎπôÍ≥† Ïπ¥Îìú */
        .bingo-card {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 3px;
            background: #f1f5f9;
            padding: 0.75rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }

        .bingo-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 0.375rem;
            font-size: 0.7rem;
            font-weight: 600;
            text-align: center;
            padding: 0.25rem;
            position: relative;
            transition: all 0.2s ease;
            min-height: 50px;
        }

        .bingo-cell.marked {
            background: #3b82f6;
            color: white;
            border-color: #2563eb;
        }

        .bingo-cell.center {
            background: #f59e0b;
            color: white;
            border-color: #d97706;
        }

        .bingo-cell.marked::after {
            content: '‚úì';
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 0.875rem;
            font-weight: bold;
        }

        /* Î¶¨ÎçîÎ≥¥Îìú */
        .leaderboard {
            max-height: 300px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .player-rank {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .rank-1 { background: #fbbf24; color: white; }
        .rank-2 { background: #9ca3af; color: white; }
        .rank-3 { background: #fb923c; color: white; }
        .rank-other { background: #dbeafe; color: #1d4ed8; }

        .player-current {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.5);
        }

        .bingo-badge {
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 700;
        }

        /* Î™®Îã¨ */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        /* ÌòÑÏû¨ Ï£ºÏ†ú */
        .current-topic {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        /* Ïª®Ìä∏Î°§ Ìå®ÎÑê */
        .control-panel {
            background: rgba(248, 250, 252, 0.8);
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0.5rem 0;
        }

        .range-input {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }

        .range-value {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.25rem;
            padding: 0.5rem;
            min-width: 3rem;
            text-align: center;
            font-weight: 700;
        }

        /* Ïú†Ìã∏Î¶¨Ìã∞ */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }

        /* Î°úÎî© */
        .loading {
            text-align: center;
            padding: 3rem 1rem;
            color: white;
        }

        .spinner {
            width: 2.5rem;
            height: 2.5rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ìë∏ÌÑ∞ */
        .footer {
            text-align: center;
            padding: 2rem 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 640px) {
            .title { font-size: 2rem; }
            .card { padding: 1rem; }
            .bingo-cell { 
                font-size: 0.65rem; 
                min-height: 45px;
                padding: 0.125rem;
            }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (min-width: 1024px) {
            .admin-grid { 
                display: grid; 
                grid-template-columns: repeat(3, 1fr); 
                gap: 1rem; 
            }
        }
    </style>
</head>
<body>
    <!-- Î°úÎî© ÌôîÎ©¥ -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <h2>üìö KDC ÎπôÍ≥† Î°úÎî©Ï§ë...</h2>
        <p>Í≤åÏûÑÏùÑ Ï§ÄÎπÑÌïòÍ≥† ÏûàÏäµÎãàÎã§</p>
    </div>

    <!-- Î©îÏù∏ Ïï± -->
    <div id="app" class="hidden">
        <!-- ÏÑ†ÌÉù Î™®Îìú -->
        <div id="select-screen">
            <div class="container">
                <div class="header">
                    <h1 class="title">üìö KDC ÎèÑÏÑúÍ¥Ä ÎπôÍ≥†</h1>
                    <p class="subtitle">ÌïúÍµ≠Ïã≠ÏßÑÎ∂ÑÎ•òÎ≤ï Í∏∞Î∞ò ÍµêÏú° ÎπôÍ≥† Í≤åÏûÑ</p>
                </div>

                <div class="status-bar">
                    <div id="connection" class="status-badge status-online">
                        üåê Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞
                    </div>
                    <button id="share-game-btn" class="btn btn-small btn-primary">
                        üîó Í≤åÏûÑ Í≥µÏú†
                    </button>
                </div>

                <div class="room-info">
                    <span id="room-display">üè¢ Í≤åÏûÑ Î£∏: <span id="room-code-display" class="room-code">ABC123</span></span>
                </div>

                <div class="card">
                    <h2 class="text-center mb-2">üéØ Í≤åÏûÑ Ï∞∏Ïó¨</h2>
                    
                    <div id="shared-notice" class="hidden" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center; color: #065f46;">
                        üéâ Í≥µÏú† ÎßÅÌÅ¨Î°ú Ï†ëÏÜçÌïòÏÖ®ÏäµÎãàÎã§!
                    </div>
                    
                    <div class="flex flex-col gap-3">
                        <button id="admin-mode-btn" class="btn btn-danger btn-full">
                            üîê Í¥ÄÎ¶¨ÏûêÎ°ú Í≤åÏûÑ ÏßÑÌñâ
                        </button>
                        
                        <input id="player-name-input" type="text" class="input" placeholder="Ï∞∏Í∞ÄÏûê Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" maxlength="20">
                        
                        <button id="join-game-btn" class="btn btn-primary btn-full" disabled>
                            üë• Ï∞∏Í∞ÄÏûêÎ°ú Í≤åÏûÑ Ï∞∏Ïó¨
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="flex items-center justify-between mb-2">
                        <h3>üìä Í≤åÏûÑ ÌòÑÌô©</h3>
                        <button id="refresh-btn" class="btn btn-small btn-secondary">üîÑ</button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="total-players" class="stat-number stat-blue">0</div>
                            <div class="stat-label">Ï∞∏Í∞ÄÏûê</div>
                        </div>
                        <div class="stat-card">
                            <div id="called-topics" class="stat-number stat-green">0</div>
                            <div class="stat-label">Ìò∏Ï∂ú Ï£ºÏ†ú</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h4 class="mb-1">üí° ÏÇ¨Ïö© Î∞©Î≤ï</h4>
                    <div id="usage-text" style="font-size: 0.875rem; color: #64748b;">
                        ‚Ä¢ Í¥ÄÎ¶¨ÏûêÎäî 4ÏûêÎ¶¨ ÎπÑÎ∞ÄÎ≤àÌò∏Î°ú Í≤åÏûÑÏùÑ ÏßÑÌñâÌï©ÎãàÎã§<br>
                        ‚Ä¢ Ï∞∏Í∞ÄÏûêÎì§ÏùÄ Í≥µÏú† ÎßÅÌÅ¨Î°ú Ï†ëÏÜçÌï©ÎãàÎã§<br>
                        ‚Ä¢ Ïã§ÏãúÍ∞ÑÏúºÎ°ú Í≤åÏûÑÏù¥ ÎèôÍ∏∞ÌôîÎê©ÎãàÎã§<br>
                        ‚Ä¢ ÏÑ§Ï†ïÎêú Ï§Ñ ÏàòÎ•º ÏôÑÏÑ±ÌïòÎ©¥ ÎπôÍ≥†ÏûÖÎãàÎã§
                    </div>
                </div>
            </div>
        </div>

        <!-- Í¥ÄÎ¶¨Ïûê Î™®Îìú -->
        <div id="admin-screen" class="hidden">
            <div class="container-wide">
                <div class="header">
                    <h1 style="color: white;">üëë Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê</h1>
                    <div class="status-bar">
                        <button id="back-to-main" class="btn btn-small btn-secondary">‚Üê Î©îÏù∏ÏúºÎ°ú</button>
                        <div id="admin-connection" class="status-badge status-online">üåê Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞</div>
                        <button id="share-admin-btn" class="btn btn-small btn-warning">üîó Ï∞∏Í∞ÄÏûê ÎßÅÌÅ¨</button>
                        <button id="change-password-btn" class="btn btn-small btn-danger">üîê ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</button>
                    </div>
                    <div class="room-info">
                        Î£∏: <span id="admin-room-code" class="room-code">ABC123</span>
                    </div>
                </div>

                <div class="admin-grid">
                    <!-- Í≤åÏûÑ Ïª®Ìä∏Î°§ -->
                    <div class="card">
                        <h3 class="mb-2">üéÆ Í≤åÏûÑ Ïª®Ìä∏Î°§</h3>
                        
                        <div class="control-panel">
                            <label style="font-weight: 600; color: #8b5cf6; margin-bottom: 0.5rem; display: block;">
                                üéØ ÎπôÍ≥† ÏôÑÏÑ± Ï°∞Í±¥ (ÌïÑÏöîÌïú Ï§Ñ Ïàò)
                            </label>
                            <div class="range-container">
                                <input id="bingo-range" type="range" min="1" max="5" value="3" class="range-input">
                                <div class="range-value">
                                    <span id="bingo-value">3</span>Ï§Ñ
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #8b5cf6;">
                                <span>Ïâ¨ÏõÄ (1Ï§Ñ)</span>
                                <span>Ïñ¥Î†§ÏõÄ (5Ï§Ñ)</span>
                            </div>
                            <div id="range-warning" class="hidden" style="color: #f59e0b; font-size: 0.75rem; margin-top: 0.5rem;">
                                ‚ö†Ô∏è Í≤åÏûÑ Ï§ëÏóêÎäî Î≥ÄÍ≤ΩÌï† Ïàò ÏóÜÏäµÎãàÎã§
                            </div>
                        </div>

                        <div class="flex gap-2 mb-2">
                            <button id="game-toggle" class="btn btn-success" style="flex: 1;">
                                ‚ñ∂Ô∏è Í≤åÏûÑ ÏãúÏûë
                            </button>
                            <button id="reset-game" class="btn btn-secondary">üîÑ</button>
                        </div>

                        <button id="call-topic" class="btn btn-primary btn-full" disabled>
                            üì¢ Îã§Ïùå Ï£ºÏ†ú Ìò∏Ï∂ú (100Í∞ú ÎÇ®Ïùå)
                        </button>

                        <div id="current-topic-card" class="current-topic hidden">
                            <div style="font-weight: 600; color: #1d4ed8; margin-bottom: 0.25rem;">ÏµúÍ∑º Ìò∏Ï∂ú:</div>
                            <div id="current-topic-name" style="font-size: 1.25rem; font-weight: 700; color: #1e3a8a;">ÎèÑÏÑúÍ¥ÄÌïô</div>
                            <div id="current-topic-time" style="font-size: 0.75rem; color: #3b82f6;">
                                Î∞©Í∏à Ìò∏Ï∂úÎê®
                            </div>
                        </div>
                    </div>

                    <!-- Í≤åÏûÑ ÌòÑÌô© -->
                    <div class="card">
                        <h3 class="mb-2">üìä Ïã§ÏãúÍ∞Ñ ÌòÑÌô©</h3>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div id="admin-players" class="stat-number stat-blue">0</div>
                                <div class="stat-label">Ï∞∏Í∞ÄÏûê</div>
                            </div>
                            <div class="stat-card">
                                <div id="admin-topics" class="stat-number stat-green">0</div>
                                <div class="stat-label">Ìò∏Ï∂úÎê®</div>
                            </div>
                            <div class="stat-card">
                                <div id="admin-condition" class="stat-number stat-purple">3</div>
                                <div class="stat-label">ÏôÑÏÑ±Ï°∞Í±¥</div>
                            </div>
                            <div class="stat-card">
                                <div id="admin-completed" class="stat-number stat-orange">0</div>
                                <div class="stat-label">ÏôÑÏÑ±Ïûê</div>
                            </div>
                        </div>

                        <div>
                            <h4 class="mb-1">ÏµúÍ∑º Ìò∏Ï∂ú Ï£ºÏ†ú:</h4>
                            <div id="topics-history" style="max-height: 120px; overflow-y: auto; background: #f8fafc; padding: 0.5rem; border-radius: 0.25rem; font-size: 0.875rem;">
                                <div style="text-align: center; color: #64748b; padding: 1rem;">
                                    ÏïÑÏßÅ Ìò∏Ï∂úÎêú Ï£ºÏ†úÍ∞Ä ÏóÜÏäµÎãàÎã§
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÏàúÏúÑÌëú -->
                    <div class="card">
                        <h3 class="mb-2">üèÜ Ïã§ÏãúÍ∞Ñ ÏàúÏúÑ (<span id="rank-count">0</span>Î™Ö)</h3>
                        
                        <div id="admin-leaderboard" class="leaderboard">
                            <div style="text-align: center; padding: 2rem; color: #64748b;">
                                üë• Ï∞∏Í∞ÄÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÌîåÎ†àÏù¥Ïñ¥ Î™®Îìú -->
        <div id="player-screen" class="hidden">
            <div class="container">
                <div class="header">
                    <h1 id="player-title" style="color: white;">üéØ ÌîåÎ†àÏù¥Ïñ¥ÎãòÏùò ÎπôÍ≥†</h1>
                    <div class="status-bar">
                        <button id="player-back" class="btn btn-small btn-secondary">‚Üê Î©îÏù∏ÏúºÎ°ú</button>
                        <div id="player-connection" class="status-badge status-online">üåê Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞</div>
                    </div>
                    <div class="room-info">
                        Î£∏: <span id="player-room-code" class="room-code">ABC123</span>
                    </div>
                </div>

                <div class="card">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="my-lines" class="stat-number stat-blue">0</div>
                            <div class="stat-label">ÎπôÍ≥† Ï§Ñ</div>
                            <div id="my-bingo-status" class="hidden bingo-badge" style="margin-top: 0.25rem;">‚úÖ BINGO!</div>
                        </div>
                        <div class="stat-card">
                            <div id="my-rank" class="stat-number stat-green">#-</div>
                            <div class="stat-label">ÏàúÏúÑ</div>
                            <div id="my-medal" style="font-size: 1.25rem;"></div>
                        </div>
                        <div class="stat-card">
                            <div id="my-condition" class="stat-number stat-purple">3</div>
                            <div class="stat-label">ÏôÑÏÑ±Ï°∞Í±¥</div>
                            <div id="my-progress" style="font-size: 0.75rem; color: #8b5cf6;">(0Í∞ú Ìò∏Ï∂ú)</div>
                        </div>
                    </div>
                </div>

                <div id="player-current-topic" class="current-topic hidden">
                    <div style="font-weight: 600; color: #1d4ed8; font-size: 0.875rem;">üîä ÏµúÍ∑º Ìò∏Ï∂ú:</div>
                    <div id="player-topic-name" style="font-size: 1.125rem; font-weight: 700; color: #1e3a8a;">ÎèÑÏÑúÍ¥ÄÌïô</div>
                    <div id="player-topic-time" style="font-size: 0.75rem; color: #3b82f6;">
                        Î∞©Í∏à Ìò∏Ï∂úÎê®
                    </div>
                </div>

                <div class="card">
                    <div id="player-bingo-card" class="bingo-card">
                        <!-- ÎπôÍ≥† Ïπ¥ÎìúÍ∞Ä Ïó¨Í∏∞Ïóê ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                    </div>
                </div>

                <div class="card">
                    <div class="flex items-center justify-between mb-2">
                        <h3>üèÜ Ïã§ÏãúÍ∞Ñ ÏàúÏúÑ</h3>
                        <button id="player-refresh" class="btn btn-small btn-secondary">üîÑ</button>
                    </div>
                    
                    <div id="player-leaderboard" class="leaderboard">
                        <div style="text-align: center; padding: 1rem; color: #64748b;">
                            üë• Îã§Î•∏ Ï∞∏Í∞ÄÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨ -->
    <div id="password-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-center mb-2">üîê Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù</h3>
            
            <div id="password-setup" class="hidden">
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center;">
                    <strong>üîë ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏÑ§Ï†ïÌïòÏÑ∏Ïöî</strong><br>
                    <small>4ÏûêÎ¶¨ Ïà´ÏûêÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</small>
                </div>
                
                <div class="mb-2">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input id="new-password" type="password" class="input" placeholder="1234" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
                
                <div class="mb-2">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏</label>
                    <input id="confirm-password" type="password" class="input" placeholder="1234" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
            </div>

            <div id="password-verify">
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center;">
                    <strong>üîê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</strong>
                </div>
                
                <div class="mb-2">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input id="verify-password" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
                
                <div class="text-center mb-2">
                    <button id="forgot-password" class="btn btn-small btn-secondary">
                        üîÑ ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï
                    </button>
                </div>
            </div>

            <div id="password-error" class="hidden" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.5rem; padding: 0.5rem; margin-bottom: 1rem; text-align: center; color: #991b1b;">
                ‚ùå ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§
            </div>
            
            <div class="flex gap-3">
                <button id="password-confirm" class="btn btn-primary" style="flex: 1;" disabled>
                    üîì ÌôïÏù∏
                </button>
                <button id="password-cancel" class="btn btn-secondary" style="flex: 1;">
                    Ï∑®ÏÜå
                </button>
            </div>
        </div>
    </div>

    <!-- Í≥µÏú† Î™®Îã¨ -->
    <div id="share-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-center mb-2">üîó Ï∞∏Í∞ÄÏûê ÎßÅÌÅ¨ Í≥µÏú†</h3>
            
            <div class="mb-2">
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Í≤åÏûÑ Î£∏ ÏΩîÎìú</label>
                <div class="flex gap-2">
                    <div id="share-room-code" class="room-code" style="flex: 1; text-align: center; padding: 0.75rem; font-size: 1.25rem;">ABC123</div>
                    <button id="copy-room" class="btn btn-small btn-secondary">üìã</button>
                </div>
            </div>
            
            <div class="mb-2">
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Ï∞∏Í∞ÄÏûê Ï†ÑÏö© ÎßÅÌÅ¨</label>
                <div id="share-url" style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; font-size: 0.75rem; word-break: break-all; max-height: 4rem; overflow-y: auto; border: 1px solid #e2e8f0;">
                    https://example.com/?room=ABC123&mode=player
                </div>
            </div>
            
            <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center;">
                üí° Ïù¥ ÎßÅÌÅ¨Î°ú Ï†ëÏÜçÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Ï∞∏Í∞ÄÏûê Î™®ÎìúÎ°ú ÏûÖÏû•Îê©ÎãàÎã§
            </div>
            
            <div class="flex gap-3">
                <button id="share-link" class="btn btn-primary" style="flex: 1;">
                    üì± ÎßÅÌÅ¨ Í≥µÏú†
                </button>
                <button id="close-share" class="btn btn-secondary" style="flex: 1;">
                    Îã´Í∏∞
                </button>
            </div>
        </div>
    </div>

    <!-- Ìë∏ÌÑ∞ -->
    <div class="footer">
        üìö Made by <strong>2025 ÏÇ¨ÎåÄÎèÑÌòë ÏÇ¨Î¨¥Íµ≠</strong>
    </div>

    <script>
        // KDC Ï£ºÏ†ú Îç∞Ïù¥ÌÑ∞
        const KDC_TOPICS = [
            'ÎèÑÏÑúÍ¥ÄÌïô', 'Ï†ïÎ≥¥Ìïô', 'Î∞±Í≥ºÏÇ¨Ï†Ñ', 'ÎÖºÎ¨∏ÏûëÏÑ±Î≤ï', 'Ïª¥Ìì®ÌÑ∞Í≥ºÌïô', 'Ïù∏ÌÑ∞ÎÑ∑', 'Ï†ÄÎÑêÎ¶¨Ï¶ò', 'Ïã†Î¨∏Ìïô', 'Ïû°ÏßÄÌïô', 'Ï∂úÌåêÌïô',
            'ÌòïÏù¥ÏÉÅÌïô', 'Ïù∏ÏãùÎ°†', 'ÎÖºÎ¶¨Ìïô', 'Ïú§Î¶¨Ìïô', 'ÎØ∏Ìïô', 'Ïã¨Î¶¨Ìïô', 'Ï≤†ÌïôÏÇ¨', 'ÎèôÏñëÏ≤†Ìïô', 'ÏÑúÏñëÏ≤†Ìïô', 'Ï¢ÖÍµêÏ≤†Ìïô',
            'Í∏∞ÎèÖÍµê', 'Î∂àÍµê', 'Ïù¥Ïä¨ÎûåÍµê', 'ÌûåÎëêÍµê', 'Ïú†Íµê', 'ÎèÑÍµê', 'Ïã†ÌôîÌïô', 'Ï¢ÖÍµêÏÇ¨', 'Ï¢ÖÍµêÏ≤†Ìïô', 'Ï¢ÖÍµêÎ¨∏Ìôî',
            'ÏÇ¨ÌöåÌïô', 'Ï†ïÏπòÌïô', 'ÌñâÏ†ïÌïô', 'Î≤ïÌïô', 'Í≤ΩÏ†úÌïô', 'ÌÜµÍ≥ÑÌïô', 'ÍµêÏú°Ìïô', 'ÎØºÏÜçÌïô', 'Íµ≠Î∞©Ìïô', 'ÏÇ¨ÌöåÎ¨∏Ï†ú',
            'ÏàòÌïô', 'Î¨ºÎ¶¨Ìïô', 'ÌôîÌïô', 'ÏÉùÎ¨ºÌïô', 'ÏßÄÍµ¨Í≥ºÌïô', 'Ï≤úÎ¨∏Ìïô', 'Í∏∞ÏÉÅÌïô', 'ÏßÄÏßàÌïô', 'ÏÉùÌÉúÌïô', 'ÌôòÍ≤ΩÍ≥ºÌïô',
            'ÏùòÌïô', 'Í≥µÌïô', 'ÎÜçÌïô', 'Í±¥Ï∂ïÌïô', 'Í∏∞Í≥ÑÍ≥µÌïô', 'Ï†ÑÏûêÍ≥µÌïô', 'Ïª¥Ìì®ÌÑ∞Í≥µÌïô', 'ÌôîÌïôÍ≥µÌïô', 'ÌÜ†Î™©Í≥µÌïô', 'ÏÇ∞ÏóÖÍ≥µÌïô',
            'ÎØ∏Ïà†', 'Ï°∞Í∞Å', 'Í≥µÏòà', 'ÏÑúÏòà', 'ÌöåÌôî', 'Í±¥Ï∂ïÏòàÏà†', 'ÏÇ¨ÏßÑ', 'ÏùåÏïÖ', 'Î¨¥Ïö©', 'Ïó∞Í∑π',
            'Ïñ∏Ïñ¥Ìïô', 'ÌïúÍµ≠Ïñ¥', 'Ï§ëÍµ≠Ïñ¥', 'ÏùºÎ≥∏Ïñ¥', 'ÏòÅÏñ¥', 'ÎèÖÏùºÏñ¥', 'ÌîÑÎûëÏä§Ïñ¥', 'Ïä§ÌéòÏù∏Ïñ¥', 'Îü¨ÏãúÏïÑÏñ¥', 'ÏïÑÎûçÏñ¥',
            'Î¨∏ÌïôÏù¥Î°†', 'ÌïúÍµ≠Î¨∏Ìïô', 'Ï§ëÍµ≠Î¨∏Ìïô', 'ÏùºÎ≥∏Î¨∏Ìïô', 'ÏòÅÎØ∏Î¨∏Ìïô', 'ÎèÖÏùºÎ¨∏Ìïô', 'ÌîÑÎûëÏä§Î¨∏Ìïô', 'ÏãúÎ¨∏Ìïô', 'ÏÜåÏÑ§', 'Ìù¨Í≥°',
            'Ïó≠ÏÇ¨Ìïô', 'ÌïúÍµ≠ÏÇ¨', 'ÎèôÏñëÏÇ¨', 'ÏÑúÏñëÏÇ¨', 'ÏÑ∏Í≥ÑÏÇ¨', 'Í≥†Í≥†Ìïô', 'Ï†ÑÍ∏∞', 'ÏßÄÎ¶¨Ìïô', 'Ïó¨ÌñâÍ∏∞', 'Î¨∏ÌôîÏÇ¨'
        ];

        // Í≤åÏûÑ ÏÉÅÌÉú Í¥ÄÎ¶¨
        class BingoGame {
            constructor() {
                this.gameRoom = '';
                this.gameMode = 'select';
                this.gameState = 'waiting';
                this.calledTopics = [];
                this.currentTopic = '';
                this.players = new Map();
                this.playerId = '';
                this.playerName = '';
                this.playerCard = [];
                this.requiredBingoLines = 3;
                this.isSharedLink = false;
                this.lastUpdate = Date.now();
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadGameState();
                this.startSync();
                this.checkConnection();
                this.hideLoading();
            }

            hideLoading() {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
            }

            setupEventListeners() {
                // Î©îÏù∏ Î≤ÑÌäºÎì§
                document.getElementById('admin-mode-btn').addEventListener('click', () => this.showPasswordModal());
                document.getElementById('join-game-btn').addEventListener('click', () => this.joinAsPlayer());
                document.getElementById('share-game-btn').addEventListener('click', () => this.showShareModal());
                document.getElementById('refresh-btn').addEventListener('click', () => this.refreshGame());
                
                // ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ ÏûÖÎ†•
                const nameInput = document.getElementById('player-name-input');
                nameInput.addEventListener('input', (e) => {
                    document.getElementById('join-game-btn').disabled = !e.target.value.trim();
                });
                nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && e.target.value.trim()) this.joinAsPlayer();
                });

                // Í¥ÄÎ¶¨Ïûê Î≤ÑÌäºÎì§
                document.getElementById('back-to-main').addEventListener('click', () => this.showScreen('select'));
                document.getElementById('share-admin-btn').addEventListener('click', () => this.showShareModal());
                document.getElementById('change-password-btn').addEventListener('click', () => this.changePassword());
                document.getElementById('game-toggle').addEventListener('click', () => this.toggleGame());
                document.getElementById('reset-game').addEventListener('click', () => this.resetGame());
                document.getElementById('call-topic').addEventListener('click', () => this.callTopic());

                // ÌîåÎ†àÏù¥Ïñ¥ Î≤ÑÌäºÎì§
                document.getElementById('player-back').addEventListener('click', () => this.showScreen('select'));
                document.getElementById('player-refresh').addEventListener('click', () => this.refreshGame());

                // ÎπôÍ≥† ÎùºÏù∏ ÏÑ§Ï†ï
                const rangeInput = document.getElementById('bingo-range');
                rangeInput.addEventListener('input', (e) => {
                    this.setRequiredLines(parseInt(e.target.value));
                });

                // ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨
                document.getElementById('password-confirm').addEventListener('click', () => this.confirmPassword());
                document.getElementById('password-cancel').addEventListener('click', () => this.hidePasswordModal());
                document.getElementById('forgot-password').addEventListener('click', () => this.resetPassword());

                // ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†• ÌïÑÎìúÎì§
                ['new-password', 'confirm-password', 'verify-password'].forEach(id => {
                    const input = document.getElementById(id);
                    input.addEventListener('input', (e) => {
                        e.target.value = e.target.value.replace(/[^0-9]/g, '');
                        this.validatePassword();
                    });
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.confirmPassword();
                    });
                });

                // Í≥µÏú† Î™®Îã¨
                document.getElementById('copy-room').addEventListener('click', () => this.copyText(this.gameRoom));
                document.getElementById('share-link').addEventListener('click', () => this.shareLink());
                document.getElementById('close-share').addEventListener('click', () => this.hideShareModal());
            }

            loadGameState() {
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                const mode = urlParams.get('mode');
                
                if (roomId) {
                    this.gameRoom = roomId;
                    if (mode === 'player') {
                        this.isSharedLink = true;
                        document.getElementById('admin-mode-btn').classList.add('hidden');
                        document.getElementById('shared-notice').classList.remove('hidden');
                        document.getElementById('share-game-btn').classList.add('hidden');
                        document.getElementById('usage-text').innerHTML = 
                            '‚Ä¢ Ïù¥ÎØ∏ ÏÑ§Ï†ïÎêú Í≤åÏûÑÏóê Ï∞∏Í∞ÄÏûêÎ°ú ÏûÖÏû•Ìï©ÎãàÎã§<br>' +
                            '‚Ä¢ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÍ≥† Í≤åÏûÑÏóê Ï∞∏Ïó¨ÌïòÏÑ∏Ïöî<br>' +
                            '‚Ä¢ Í¥ÄÎ¶¨ÏûêÍ∞Ä Ï£ºÏ†úÎ•º Ìò∏Ï∂úÌïòÎ©¥ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§<br>' +
                            '‚Ä¢ ÏÑ§Ï†ïÎêú Ï§Ñ ÏàòÎ•º ÏôÑÏÑ±ÌïòÎ©¥ ÎπôÍ≥†ÏûÖÎãàÎã§';
                    }
                    
                    // Ï†ÄÏû•Îêú ÏÉÅÌÉú Î°úÎìú
                    const saved = this.loadSavedState(roomId);
                    if (saved) this.restoreState(saved);
                } else {
                    this.gameRoom = this.generateRoomId();
                    this.updateUrl();
                }
                
                this.updateUI();
            }

            generateRoomId() {
                return Math.random().toString(36).substr(2, 8).toUpperCase();
            }

            updateUrl() {
                const params = new URLSearchParams();
                params.set('room', this.gameRoom);
                if (this.isSharedLink) params.set('mode', 'player');
                window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);
            }

            loadSavedState(roomId) {
                try {
                    const saved = localStorage.getItem(`kdc-bingo-${roomId}`);
                    if (saved) {
                        const data = JSON.parse(saved);
                        if (Date.now() - data.lastUpdate < 24 * 60 * 60 * 1000) {
                            return data;
                        }
                    }
                } catch (e) {}
                return null;
            }

            saveState() {
                try {
                    const state = {
                        calledTopics: this.calledTopics,
                        currentTopic: this.currentTopic,
                        gameState: this.gameState,
                        requiredBingoLines: this.requiredBingoLines,
                        players: Array.from(this.players.entries()),
                        lastUpdate: Date.now()
                    };
                    localStorage.setItem(`kdc-bingo-${this.gameRoom}`, JSON.stringify(state));
                } catch (e) {}
            }

            restoreState(saved) {
                if (saved.calledTopics) this.calledTopics = saved.calledTopics;
                if (saved.currentTopic) this.currentTopic = saved.currentTopic;
                if (saved.gameState) this.gameState = saved.gameState;
                if (saved.requiredBingoLines) this.requiredBingoLines = saved.requiredBingoLines;
                if (saved.players) this.players = new Map(saved.players);
                this.lastUpdate = saved.lastUpdate || Date.now();
            }

            startSync() {
                setInterval(() => {
                    this.saveState();
                    this.loadRemoteState();
                    this.updateUI();
                }, 2000);
            }

            loadRemoteState() {
                const saved = this.loadSavedState(this.gameRoom);
                if (saved && saved.lastUpdate > this.lastUpdate) {
                    this.restoreState(saved);
                    this.updatePlayerCard();
                }
            }

            checkConnection() {
                setInterval(() => {
                    const online = navigator.onLine;
                    document.querySelectorAll('[id$="connection"]').forEach(el => {
                        el.className = `status-badge ${online ? 'status-online' : 'status-offline'}`;
                        el.textContent = online ? 'üåê Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞' : 'üìµ Ïò§ÌîÑÎùºÏù∏';
                    });
                }, 3000);
            }

            showScreen(screen) {
                ['select-screen', 'admin-screen', 'player-screen'].forEach(id => {
                    document.getElementById(id).classList.add('hidden');
                });
                document.getElementById(`${screen}-screen`).classList.remove('hidden');
                this.gameMode = screen;
                this.updateUI();
            }

            // ÎπÑÎ∞ÄÎ≤àÌò∏ Í¥ÄÎ¶¨
            showPasswordModal() {
                const hasPassword = this.hasPassword();
                document.getElementById('password-setup').classList.toggle('hidden', hasPassword);
                document.getElementById('password-verify').classList.toggle('hidden', !hasPassword);
                this.clearPasswordInputs();
                document.getElementById('password-modal').classList.remove('hidden');
                
                if (hasPassword) {
                    document.getElementById('verify-password').focus();
                } else {
                    document.getElementById('new-password').focus();
                }
            }

            hidePasswordModal() {
                document.getElementById('password-modal').classList.add('hidden');
                this.clearPasswordInputs();
                this.hidePasswordError();
            }

            hasPassword() {
                return localStorage.getItem(`admin-pwd-${this.gameRoom}`) !== null;
            }

            savePassword(password) {
                const hash = btoa(password + this.gameRoom);
                localStorage.setItem(`admin-pwd-${this.gameRoom}`, hash);
            }

            verifyPassword(password) {
                const stored = localStorage.getItem(`admin-pwd-${this.gameRoom}`);
                const hash = btoa(password + this.gameRoom);
                return stored === hash;
            }

            confirmPassword() {
                const hasPassword = this.hasPassword();
                
                if (hasPassword) {
                    const password = document.getElementById('verify-password').value;
                    if (this.verifyPassword(password)) {
                        this.hidePasswordModal();
                        this.showScreen('admin');
                    } else {
                        this.showPasswordError('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§');
                    }
                } else {
                    const newPwd = document.getElementById('new-password').value;
                    const confirmPwd = document.getElementById('confirm-password').value;
                    
                    if (newPwd.length !== 4) {
                        this.showPasswordError('4ÏûêÎ¶¨ Ïà´ÏûêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                        return;
                    }
                    
                    if (newPwd !== confirmPwd) {
                        this.showPasswordError('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§');
                        return;
                    }
                    
                    this.savePassword(newPwd);
                    this.hidePasswordModal();
                    this.showScreen('admin');
                    alert('üîê Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§!');
                }
            }

            validatePassword() {
                const hasPassword = this.hasPassword();
                const confirmBtn = document.getElementById('password-confirm');
                
                if (hasPassword) {
                    const password = document.getElementById('verify-password').value;
                    confirmBtn.disabled = password.length !== 4;
                    confirmBtn.textContent = 'üîì Î°úÍ∑∏Ïù∏';
                } else {
                    const newPwd = document.getElementById('new-password').value;
                    const confirmPwd = document.getElementById('confirm-password').value;
                    const valid = newPwd.length === 4 && confirmPwd.length === 4;
                    
                    confirmBtn.disabled = !valid;
                    confirmBtn.textContent = 'üîê ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï';
                    
                    if (valid && newPwd !== confirmPwd) {
                        this.showPasswordError('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§');
                    } else {
                        this.hidePasswordError();
                    }
                }
            }

            showPasswordError(msg) {
                const errorEl = document.getElementById('password-error');
                errorEl.textContent = `‚ùå ${msg}`;
                errorEl.classList.remove('hidden');
            }

            hidePasswordError() {
                document.getElementById('password-error').classList.add('hidden');
            }

            clearPasswordInputs() {
                ['new-password', 'confirm-password', 'verify-password'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                this.validatePassword();
            }

            changePassword() {
                if (confirm('üîê Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem(`admin-pwd-${this.gameRoom}`);
                    this.showPasswordModal();
                }
            }

            resetPassword() {
                if (confirm('üîÑ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ïû¨ÏÑ§Ï†ïÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    localStorage.removeItem(`admin-pwd-${this.gameRoom}`);
                    this.hidePasswordModal();
                    this.showPasswordModal();
                }
            }

            // Í≥µÏú† Í∏∞Îä•
            showShareModal() {
                document.getElementById('share-room-code').textContent = this.gameRoom;
                document.getElementById('share-url').textContent = 
                    `${window.location.origin}${window.location.pathname}?room=${this.gameRoom}&mode=player`;
                document.getElementById('share-modal').classList.remove('hidden');
            }

            hideShareModal() {
                document.getElementById('share-modal').classList.add('hidden');
            }

            shareLink() {
                const url = `${window.location.origin}${window.location.pathname}?room=${this.gameRoom}&mode=player`;
                if (navigator.share) {
                    navigator.share({
                        title: 'üìö KDC ÎèÑÏÑúÍ¥Ä ÎπôÍ≥† Í≤åÏûÑ',
                        text: 'Ìï®Íªò ÎπôÍ≥† Í≤åÏûÑÏóê Ï∞∏Ïó¨ÌïòÏÑ∏Ïöî!',
                        url: url
                    }).catch(() => this.copyText(url));
                } else {
                    this.copyText(url);
                }
            }

            copyText(text) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        alert('üîó ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                    }).catch(() => this.fallbackCopy(text));
                } else {
                    this.fallbackCopy(text);
                }
            }

            fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    if (document.execCommand('copy')) {
                        alert('üîó ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                    } else {
                        prompt('ÎßÅÌÅ¨Î•º Î≥µÏÇ¨ÌïòÏÑ∏Ïöî:', text);
                    }
                } catch (e) {
                    prompt('ÎßÅÌÅ¨Î•º Î≥µÏÇ¨ÌïòÏÑ∏Ïöî:', text);
                }
                
                document.body.removeChild(textArea);
            }

            // Í≤åÏûÑ Î°úÏßÅ
            joinAsPlayer() {
                const name = document.getElementById('player-name-input').value.trim();
                if (!name) return;
                
                this.playerName = name;
                this.playerId = `player_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`;
                this.playerCard = this.generateBingoCard();
                this.playerCard[12].marked = true; // Í∞ÄÏö¥Îç∞ FREE
                
                // Ïù¥ÎØ∏ Ìò∏Ï∂úÎêú Ï£ºÏ†ú ÎßàÌÇπ
                this.calledTopics.forEach(topic => {
                    this.playerCard.forEach(cell => {
                        if (cell.topic === topic) cell.marked = true;
                    });
                });

                this.players.set(this.playerId, {
                    name: this.playerName,
                    card: this.playerCard,
                    bingoLines: this.checkBingo(this.playerCard),
                    joinTime: Date.now()
                });
                
                this.showScreen('player');
                this.saveState();
            }

            generateBingoCard() {
                const shuffled = [...KDC_TOPICS].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, 25).map((topic, index) => ({
                    id: index,
                    topic,
                    marked: false,
                    isCenter: index === 12
                }));
            }

            checkBingo(card) {
                const grid = [];
                for (let i = 0; i < 5; i++) {
                    grid.push(card.slice(i * 5, (i + 1) * 5));
                }

                let count = 0;
                
                // Í∞ÄÎ°úÏ§Ñ
                for (let i = 0; i < 5; i++) {
                    if (grid[i].every(cell => cell.marked)) count++;
                }
                
                // ÏÑ∏Î°úÏ§Ñ
                for (let j = 0; j < 5; j++) {
                    if (grid.every(row => row[j].marked)) count++;
                }
                
                // ÎåÄÍ∞ÅÏÑ†
                if (grid.every((row, i) => row[i].marked)) count++;
                if (grid.every((row, i) => row[4 - i].marked)) count++;
                
                return count;
            }

            isBingoComplete(lines) {
                return lines >= this.requiredBingoLines;
            }

            toggleGame() {
                this.gameState = this.gameState === 'playing' ? 'paused' : 'playing';
                this.saveState();
                this.updateUI();
            }

            resetGame() {
                if (confirm('üîÑ Í≤åÏûÑÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    this.calledTopics = [];
                    this.currentTopic = '';
                    this.gameState = 'waiting';
                    this.players.clear();
                    this.requiredBingoLines = 3;
                    localStorage.removeItem(`kdc-bingo-${this.gameRoom}`);
                    this.updateUI();
                }
            }

            callTopic() {
                const uncalled = KDC_TOPICS.filter(topic => !this.calledTopics.includes(topic));
                if (uncalled.length === 0) return;

                const topic = uncalled[Math.floor(Math.random() * uncalled.length)];
                this.currentTopic = topic;
                this.calledTopics.push(topic);
                this.lastUpdate = Date.now();
                
                // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
                this.players.forEach((player, id) => {
                    const updatedCard = player.card.map(cell => 
                        cell.topic === topic ? { ...cell, marked: true } : cell
                    );
                    this.players.set(id, {
                        ...player,
                        card: updatedCard,
                        bingoLines: this.checkBingo(updatedCard)
                    });
                });

                this.updatePlayerCard();
                this.saveState();
                this.updateUI();
            }

            updatePlayerCard() {
                if (this.gameMode === 'player' && this.playerId) {
                    this.playerCard = this.playerCard.map(cell => 
                        this.calledTopics.includes(cell.topic) ? { ...cell, marked: true } : cell
                    );
                    
                    if (this.players.has(this.playerId)) {
                        const player = this.players.get(this.playerId);
                        player.card = this.playerCard;
                        player.bingoLines = this.checkBingo(this.playerCard);
                        this.players.set(this.playerId, player);
                    }
                }
            }

            setRequiredLines(lines) {
                if (this.gameState === 'playing' && this.calledTopics.length > 0) return;
                this.requiredBingoLines = lines;
                this.saveState();
                this.updateUI();
            }

            refreshGame() {
                this.loadRemoteState();
                this.updateUI();
            }

            getLeaderboard() {
                return Array.from(this.players.entries())
                    .map(([id, player]) => ({ id, ...player }))
                    .sort((a, b) => {
                        if (b.bingoLines !== a.bingoLines) return b.bingoLines - a.bingoLines;
                        return a.joinTime - b.joinTime; // Í∞ôÏùÄ Ï§Ñ ÏàòÎ©¥ Î®ºÏ†Ä Ï∞∏Ïó¨Ìïú ÏÇ¨ÎûåÏù¥ ÏïûÏÑú
                    });
            }

            updateUI() {
                this.updateRoomInfo();
                this.updateStats();
                this.updateGameControls();
                this.updateCurrentTopic();
                this.updateLeaderboard();
                this.updateBingoCard();
                this.updatePlayerStatus();
            }

            updateRoomInfo() {
                document.querySelectorAll('[id*="room-code"]').forEach(el => {
                    el.textContent = this.gameRoom;
                });
            }

            updateStats() {
                const playerCount = this.players.size;
                const topicCount = this.calledTopics.length;
                
                document.getElementById('total-players').textContent = playerCount;
                document.getElementById('called-topics').textContent = topicCount;
                document.getElementById('admin-players').textContent = playerCount;
                document.getElementById('admin-topics').textContent = topicCount;
                document.getElementById('admin-condition').textContent = this.requiredBingoLines;
                document.getElementById('admin-completed').textContent = 
                    this.getLeaderboard().filter(p => this.isBingoComplete(p.bingoLines)).length;
                document.getElementById('rank-count').textContent = playerCount;
            }

            updateGameControls() {
                if (this.gameMode !== 'admin') return;

                const toggleBtn = document.getElementById('game-toggle');
                const callBtn = document.getElementById('call-topic');
                const rangeInput = document.getElementById('bingo-range');
                const rangeValue = document.getElementById('bingo-value');
                const rangeWarning = document.getElementById('range-warning');

                // Í≤åÏûÑ ÌÜ†Í∏Ä Î≤ÑÌäº
                if (this.gameState === 'playing') {
                    toggleBtn.textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
                    toggleBtn.className = 'btn btn-warning';
                } else {
                    toggleBtn.textContent = '‚ñ∂Ô∏è Í≤åÏûÑ ÏãúÏûë';
                    toggleBtn.className = 'btn btn-success';
                }

                // Ï£ºÏ†ú Ìò∏Ï∂ú Î≤ÑÌäº
                const remaining = KDC_TOPICS.length - this.calledTopics.length;
                callBtn.textContent = `üì¢ Îã§Ïùå Ï£ºÏ†ú Ìò∏Ï∂ú (${remaining}Í∞ú ÎÇ®Ïùå)`;
                callBtn.disabled = this.gameState !== 'playing' || remaining === 0;

                // ÎπôÍ≥† ÎùºÏù∏ ÏÑ§Ï†ï
                rangeInput.value = this.requiredBingoLines;
                rangeValue.textContent = this.requiredBingoLines;
                
                const gameActive = this.gameState === 'playing' && this.calledTopics.length > 0;
                rangeInput.disabled = gameActive;
                rangeWarning.classList.toggle('hidden', !gameActive);
            }

            updateCurrentTopic() {
                const displays = [
                    { card: 'current-topic-card', name: 'current-topic-name', time: 'current-topic-time' },
                    { card: 'player-current-topic', name: 'player-topic-name', time: 'player-topic-time' }
                ];

                displays.forEach(({ card, name, time }) => {
                    const cardEl = document.getElementById(card);
                    if (this.currentTopic) {
                        document.getElementById(name).textContent = this.currentTopic;
                        document.getElementById(time).textContent = 'Î∞©Í∏à Ìò∏Ï∂úÎê®';
                        cardEl.classList.remove('hidden');
                    } else {
                        cardEl.classList.add('hidden');
                    }
                });

                // Ï£ºÏ†ú ÌûàÏä§ÌÜ†Î¶¨
                const historyEl = document.getElementById('topics-history');
                if (this.calledTopics.length === 0) {
                    historyEl.innerHTML = '<div style="text-align: center; color: #64748b; padding: 1rem;">ÏïÑÏßÅ Ìò∏Ï∂úÎêú Ï£ºÏ†úÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
                } else {
                    historyEl.innerHTML = [...this.calledTopics].reverse().slice(0, 10).map((topic, index) => 
                        `<div style="padding: 0.25rem 0; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between;">
                            <span>${topic}</span>
                            <span style="color: #94a3b8;">#${this.calledTopics.length - index}</span>
                        </div>`
                    ).join('');
                }
            }

            updateLeaderboard() {
                const leaderboard = this.getLeaderboard();
                const containers = ['admin-leaderboard', 'player-leaderboard'];

                containers.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (!container) return;

                    if (leaderboard.length === 0) {
                        container.innerHTML = `<div style="text-align: center; padding: 2rem; color: #64748b;">
                            üë• ${containerId.includes('player') ? 'Îã§Î•∏ Ï∞∏Í∞ÄÏûêÍ∞Ä' : 'Ï∞∏Í∞ÄÏûêÍ∞Ä'} ÏóÜÏäµÎãàÎã§
                        </div>`;
                        return;
                    }

                    container.innerHTML = leaderboard.map((player, index) => {
                        const isCurrentPlayer = player.id === this.playerId;
                        const isComplete = this.isBingoComplete(player.bingoLines);
                        
                        let rankClass = 'rank-other';
                        let emoji = '';
                        let itemClass = 'player-item';
                        
                        if (index === 0) {
                            rankClass = 'rank-1';
                            emoji = 'üëë';
                        } else if (index === 1) {
                            rankClass = 'rank-2';
                            emoji = 'ü•à';
                        } else if (index === 2) {
                            rankClass = 'rank-3';
                            emoji = 'ü•â';
                        }
                        
                        if (isCurrentPlayer) itemClass += ' player-current';

                        return `
                            <div class="${itemClass}">
                                <div class="player-info">
                                    <div class="player-rank ${rankClass}">${index + 1}</div>
                                    <div>
                                        <div style="font-weight: 600; display: flex; align-items: center; gap: 0.25rem;">
                                            ${player.name}
                                            ${isCurrentPlayer ? '<span style="color: #10b981;">üë§</span>' : ''}
                                        </div>
                                        <div style="font-size: 0.875rem; color: #64748b;">
                                            ${player.bingoLines}Ï§Ñ ÏôÑÏÑ±
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    ${emoji ? `<div style="font-size: 1.25rem; margin-bottom: 0.25rem;">${emoji}</div>` : ''}
                                    ${isComplete ? '<div class="bingo-badge">‚úÖ BINGO!</div>' : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                });
            }

            updateBingoCard() {
                if (this.gameMode !== 'player' || !this.playerCard.length) return;

                const container = document.getElementById('player-bingo-card');
                container.innerHTML = this.playerCard.map(cell => {
                    let cellClass = 'bingo-cell';
                    let content = cell.topic;
                    
                    if (cell.isCenter) {
                        cellClass += ' center';
                        content = '<div style="font-size: 0.875rem;">‚≠ê</div><div style="font-size: 0.625rem;">FREE</div>';
                    } else if (cell.marked) {
                        cellClass += ' marked';
                    }
                    
                    return `<div class="${cellClass}">${content}</div>`;
                }).join('');
            }

            updatePlayerStatus() {
                if (this.gameMode !== 'player') return;

                document.getElementById('player-title').textContent = `üéØ ${this.playerName}ÎãòÏùò ÎπôÍ≥†`;
                document.getElementById('my-condition').textContent = this.requiredBingoLines;
                document.getElementById('my-progress').textContent = `(${this.calledTopics.length}Í∞ú Ìò∏Ï∂ú)`;

                if (this.playerId && this.players.has(this.playerId)) {
                    const player = this.players.get(this.playerId);
                    const leaderboard = this.getLeaderboard();
                    const rank = leaderboard.findIndex(p => p.id === this.playerId) + 1;
                    const isComplete = this.isBingoComplete(player.bingoLines);

                    document.getElementById('my-lines').textContent = player.bingoLines;
                    document.getElementById('my-lines').style.color = isComplete ? '#ef4444' : '#3b82f6';
                    document.getElementById('my-rank').textContent = rank ? `#${rank}` : '#-';
                    
                    document.getElementById('my-bingo-status').classList.toggle('hidden', !isComplete);
                    
                    const medal = document.getElementById('my-medal');
                    if (rank === 1) medal.textContent = 'üëë';
                    else if (rank === 2) medal.textContent = 'ü•à';
                    else if (rank === 3) medal.textContent = 'ü•â';
                    else medal.textContent = '';
                }
            }
        }

        // Ïï± ÏãúÏûë
        document.addEventListener('DOMContentLoaded', () => {
            new BingoGame();
        });
    </script>
</body>
</html>
