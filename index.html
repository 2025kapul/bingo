<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š KDC ë„ì„œê´€ ë¹™ê³  ê²Œì„ - 2025 ì‚¬ëŒ€ë„í˜‘ ì‚¬ë¬´êµ­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1a202c;
            line-height: 1.6;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 1rem;
        }

        .container-wide {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            padding: 2rem 0 1rem;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1.25rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            min-height: 44px;
            user-select: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:not(:disabled):hover {
            transform: translateY(-1px);
        }

        .btn:not(:disabled):active {
            transform: translateY(0);
        }

        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover:not(:disabled) { background: #2563eb; }

        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover:not(:disabled) { background: #dc2626; }

        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover:not(:disabled) { background: #d97706; }

        .btn-success { background: #10b981; color: white; }
        .btn-success:hover:not(:disabled) { background: #059669; }

        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover:not(:disabled) { background: #4b5563; }

        .btn-small {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            min-height: 36px;
        }

        .btn-full {
            width: 100%;
        }

        /* ì…ë ¥ í•„ë“œ */
        .input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            background: white;
            transition: border-color 0.2s ease;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ìƒíƒœ í‘œì‹œ */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-online {
            background: rgba(16, 185, 129, 0.2);
            color: #065f46;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-offline {
            background: rgba(239, 68, 68, 0.2);
            color: #991b1b;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* ë£¸ ì •ë³´ */
        .room-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .room-code {
            font-family: 'SF Mono', monospace;
            font-weight: 700;
            background: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin: 0 0.25rem;
            border: 1px solid #e2e8f0;
        }

        /* í†µê³„ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .stat-number {
            font-size: 1.875rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.8;
            font-weight: 600;
        }

        .stat-blue { color: #3b82f6; }
        .stat-green { color: #10b981; }
        .stat-purple { color: #8b5cf6; }
        .stat-orange { color: #f59e0b; }

        /* ë¹™ê³  ì¹´ë“œ */
        .bingo-card {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 3px;
            background: #f1f5f9;
            padding: 0.75rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }

        .bingo-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 0.375rem;
            font-size: 0.7rem;
            font-weight: 600;
            text-align: center;
            padding: 0.25rem;
            position: relative;
            transition: all 0.2s ease;
            min-height: 50px;
        }

        .bingo-cell.marked {
            background: #3b82f6;
            color: white;
            border-color: #2563eb;
        }

        .bingo-cell.center {
            background: #f59e0b;
            color: white;
            border-color: #d97706;
        }

        .bingo-cell.marked::after {
            content: 'âœ“';
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 0.875rem;
            font-weight: bold;
        }

        /* ë¦¬ë”ë³´ë“œ */
        .leaderboard {
            max-height: 300px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .player-rank {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .rank-1 { background: #fbbf24; color: white; }
        .rank-2 { background: #9ca3af; color: white; }
        .rank-3 { background: #fb923c; color: white; }
        .rank-other { background: #dbeafe; color: #1d4ed8; }

        .player-current {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.5);
        }

        .bingo-badge {
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 700;
        }

        /* ëª¨ë‹¬ */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        /* í˜„ì¬ ì£¼ì œ */
        .current-topic {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            background: rgba(248, 250, 252, 0.8);
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0.5rem 0;
        }

        .range-input {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }

        .range-value {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.25rem;
            padding: 0.5rem;
            min-width: 3rem;
            text-align: center;
            font-weight: 700;
        }

        /* ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }

        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 3rem 1rem;
            color: white;
        }

        .spinner {
            width: 2.5rem;
            height: 2.5rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* í‘¸í„° */
        .footer {
            text-align: center;
            padding: 2rem 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 640px) {
            .title { font-size: 2rem; }
            .card { padding: 1rem; }
            .bingo-cell { 
                font-size: 0.65rem; 
                min-height: 45px;
                padding: 0.125rem;
            }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (min-width: 1024px) {
            .admin-grid { 
                display: grid; 
                grid-template-columns: repeat(3, 1fr); 
                gap: 1rem; 
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <h2>ğŸ“š KDC ë¹™ê³  ë¡œë”©ì¤‘...</h2>
        <p>ê²Œì„ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div id="app" class="hidden">
        <!-- ì„ íƒ ëª¨ë“œ -->
        <div id="select-screen">
            <div class="container">
                <div class="header">
                    <h1 class="title">ğŸ“š KDC ë„ì„œê´€ ë¹™ê³ </h1>
                    <p class="subtitle">í•œêµ­ì‹­ì§„ë¶„ë¥˜ë²• ê¸°ë°˜ êµìœ¡ ë¹™ê³  ê²Œì„</p>
                </div>

                <div class="status-bar">
                    <div id="connection" class="status-badge status-online">
                        ğŸŒ ì‹¤ì‹œê°„ ì—°ê²°
                    </div>
                    <button id="share-game-btn" class="btn btn-small btn-primary">
                        ğŸ”— ê²Œì„ ê³µìœ 
                    </button>
                </div>

                <div class="room-info">
                    <span id="room-display">ğŸ¢ ê²Œì„ ë£¸: <span id="room-code-display" class="room-code">ABC123</span></span>
                </div>

                <div class="card">
                    <h2 class="text-center mb-2">ğŸ¯ ê²Œì„ ì°¸ì—¬</h2>
                    
                    <div id="shared-notice" class="hidden" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center; color: #065f46;">
                        ğŸ‰ ê³µìœ  ë§í¬ë¡œ ì ‘ì†í•˜ì…¨ìŠµë‹ˆë‹¤!
                    </div>
                    
                    <div class="flex flex-col gap-3">
                        <button id="admin-mode-btn" class="btn btn-danger btn-full">
                            ğŸ” ê´€ë¦¬ìë¡œ ê²Œì„ ì§„í–‰
                        </button>
                        
                        <input id="player-name-input" type="text" class="input" placeholder="ì°¸ê°€ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">
                        
                        <button id="join-game-btn" class="btn btn-primary btn-full" disabled>
                            ğŸ‘¥ ì°¸ê°€ìë¡œ ê²Œì„ ì°¸ì—¬
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="flex items-center justify-between mb-2">
                        <h3>ğŸ“Š ê²Œì„ í˜„í™©</h3>
                        <button id="refresh-btn" class="btn btn-small btn-secondary">ğŸ”„</button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="total-players" class="stat-number stat-blue">0</div>
                            <div class="stat-label">ì°¸ê°€ì</div>
                        </div>
                        <div class="stat-card">
                            <div id="called-topics" class="stat-number stat-green">0</div>
                            <div class="stat-label">í˜¸ì¶œ ì£¼ì œ</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h4 class="mb-1">ğŸ’¡ ì‚¬ìš© ë°©ë²•</h4>
                    <div id="usage-text" style="font-size: 0.875rem; color: #64748b;">
                        â€¢ ê´€ë¦¬ìëŠ” 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¡œ ê²Œì„ì„ ì§„í–‰í•©ë‹ˆë‹¤<br>
                        â€¢ ì°¸ê°€ìë“¤ì€ ê³µìœ  ë§í¬ë¡œ ì ‘ì†í•©ë‹ˆë‹¤<br>
                        â€¢ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²Œì„ì´ ë™ê¸°í™”ë©ë‹ˆë‹¤<br>
                        â€¢ ì„¤ì •ëœ ì¤„ ìˆ˜ë¥¼ ì™„ì„±í•˜ë©´ ë¹™ê³ ì…ë‹ˆë‹¤
                    </div>
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ëª¨ë“œ -->
        <div id="admin-screen" class="hidden">
            <div class="container-wide">
                <div class="header">
                    <h1 style="color: white;">ğŸ‘‘ ê´€ë¦¬ì íŒ¨ë„</h1>
                    <div class="status-bar">
                        <button id="back-to-main" class="btn btn-small btn-secondary">â† ë©”ì¸ìœ¼ë¡œ</button>
                        <div id="admin-connection" class="status-badge status-online">ğŸŒ ì‹¤ì‹œê°„ ì—°ê²°</div>
                        <button id="share-admin-btn" class="btn btn-small btn-warning">ğŸ”— ì°¸ê°€ì ë§í¬</button>
                        <button id="change-password-btn" class="btn btn-small btn-danger">ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                    </div>
                    <div class="room-info">
                        ë£¸: <span id="admin-room-code" class="room-code">ABC123</span>
                    </div>
                </div>

                <div class="admin-grid">
                    <!-- ê²Œì„ ì»¨íŠ¸ë¡¤ -->
                    <div class="card">
                        <h3 class="mb-2">ğŸ® ê²Œì„ ì»¨íŠ¸ë¡¤</h3>
                        
                        <div class="control-panel">
                            <label style="font-weight: 600; color: #8b5cf6; margin-bottom: 0.5rem; display: block;">
                                ğŸ¯ ë¹™ê³  ì™„ì„± ì¡°ê±´ (í•„ìš”í•œ ì¤„ ìˆ˜)
                            </label>
                            <div class="range-container">
                                <input id="bingo-range" type="range" min="1" max="5" value="3" class="range-input">
                                <div class="range-value">
                                    <span id="bingo-value">3</span>ì¤„
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #8b5cf6;">
                                <span>ì‰¬ì›€ (1ì¤„)</span>
                                <span>ì–´ë ¤ì›€ (5ì¤„)</span>
                            </div>
                            <div id="range-warning" class="hidden" style="color: #f59e0b; font-size: 0.75rem; margin-top: 0.5rem;">
                                âš ï¸ ê²Œì„ ì¤‘ì—ëŠ” ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
                            </div>
                        </div>

                        <div class="flex gap-2 mb-2">
                            <button id="game-toggle" class="btn btn-success" style="flex: 1;">
                                â–¶ï¸ ê²Œì„ ì‹œì‘
                            </button>
                            <button id="reset-game" class="btn btn-secondary">ğŸ”„</button>
                        </div>

                        <button id="call-topic" class="btn btn-primary btn-full" disabled>
                            ğŸ“¢ ë‹¤ìŒ ì£¼ì œ í˜¸ì¶œ (100ê°œ ë‚¨ìŒ)
                        </button>

                        <div id="current-topic-card" class="current-topic hidden">
                            <div style="font-weight: 600; color: #1d4ed8; margin-bottom: 0.25rem;">ìµœê·¼ í˜¸ì¶œ:</div>
                            <div id="current-topic-name" style="font-size: 1.25rem; font-weight: 700; color: #1e3a8a;">ë„ì„œê´€í•™</div>
                            <div id="current-topic-time" style="font-size: 0.75rem; color: #3b82f6;">
                                ë°©ê¸ˆ í˜¸ì¶œë¨
                            </div>
                        </div>
                    </div>

                    <!-- ê²Œì„ í˜„í™© -->
                    <div class="card">
                        <h3 class="mb-2">ğŸ“Š ì‹¤ì‹œê°„ í˜„í™©</h3>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div id="admin-players" class="stat-number stat-blue">0</div>
                                <div class="stat-label">ì°¸ê°€ì</div>
                            </div>
                            <div class="stat-card">
                                <div id="admin-topics" class="stat-number stat-green">0</div>
                                <div class="stat-label">í˜¸ì¶œë¨</div>
                            </div>
                            <div class="stat-card">
                                <div id="admin-condition" class="stat-number stat-purple">3</div>
                                <div class="stat-label">ì™„ì„±ì¡°ê±´</div>
                            </div>
                            <div class="stat-card">
                                <div id="admin-completed" class="stat-number stat-orange">0</div>
                                <div class="stat-label">ì™„ì„±ì</div>
                            </div>
                        </div>

                        <div>
                            <h4 class="mb-1">ìµœê·¼ í˜¸ì¶œ ì£¼ì œ:</h4>
                            <div id="topics-history" style="max-height: 120px; overflow-y: auto; background: #f8fafc; padding: 0.5rem; border-radius: 0.25rem; font-size: 0.875rem;">
                                <div style="text-align: center; color: #64748b; padding: 1rem;">
                                    ì•„ì§ í˜¸ì¶œëœ ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ìˆœìœ„í‘œ -->
                    <div class="card">
                        <h3 class="mb-2">ğŸ† ì‹¤ì‹œê°„ ìˆœìœ„ (<span id="rank-count">0</span>ëª…)</h3>
                        
                        <div id="admin-leaderboard" class="leaderboard">
                            <div style="text-align: center; padding: 2rem; color: #64748b;">
                                ğŸ‘¥ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í”Œë ˆì´ì–´ ëª¨ë“œ -->
        <div id="player-screen" class="hidden">
            <div class="container">
                <div class="header">
                    <h1 id="player-title" style="color: white;">ğŸ¯ í”Œë ˆì´ì–´ë‹˜ì˜ ë¹™ê³ </h1>
                    <div class="status-bar">
                        <button id="player-back" class="btn btn-small btn-secondary">â† ë©”ì¸ìœ¼ë¡œ</button>
                        <div id="player-connection" class="status-badge status-online">ğŸŒ ì‹¤ì‹œê°„ ì—°ê²°</div>
                    </div>
                    <div class="room-info">
                        ë£¸: <span id="player-room-code" class="room-code">ABC123</span>
                    </div>
                </div>

                <div class="card">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="my-lines" class="stat-number stat-blue">0</div>
                            <div class="stat-label">ë¹™ê³  ì¤„</div>
                            <div id="my-bingo-status" class="hidden bingo-badge" style="margin-top: 0.25rem;">âœ… BINGO!</div>
                        </div>
                        <div class="stat-card">
                            <div id="my-rank" class="stat-number stat-green">#-</div>
                            <div class="stat-label">ìˆœìœ„</div>
                            <div id="my-medal" style="font-size: 1.25rem;"></div>
                        </div>
                        <div class="stat-card">
                            <div id="my-condition" class="stat-number stat-purple">3</div>
                            <div class="stat-label">ì™„ì„±ì¡°ê±´</div>
                            <div id="my-progress" style="font-size: 0.75rem; color: #8b5cf6;">(0ê°œ í˜¸ì¶œ)</div>
                        </div>
                    </div>
                </div>

                <div id="player-current-topic" class="current-topic hidden">
                    <div style="font-weight: 600; color: #1d4ed8; font-size: 0.875rem;">ğŸ”Š ìµœê·¼ í˜¸ì¶œ:</div>
                    <div id="player-topic-name" style="font-size: 1.125rem; font-weight: 700; color: #1e3a8a;">ë„ì„œê´€í•™</div>
                    <div id="player-topic-time" style="font-size: 0.75rem; color: #3b82f6;">
                        ë°©ê¸ˆ í˜¸ì¶œë¨
                    </div>
                </div>

                <div class="card">
                    <div id="player-bingo-card" class="bingo-card">
                        <!-- ë¹™ê³  ì¹´ë“œê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <div class="card">
                    <div class="flex items-center justify-between mb-2">
                        <h3>ğŸ† ì‹¤ì‹œê°„ ìˆœìœ„</h3>
                        <button id="player-refresh" class="btn btn-small btn-secondary">ğŸ”„</button>
                    </div>
                    
                    <div id="player-leaderboard" class="leaderboard">
                        <div style="text-align: center; padding: 1rem; color: #64748b;">
                            ğŸ‘¥ ë‹¤ë¥¸ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
    <div id="password-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-center mb-2">ğŸ” ê´€ë¦¬ì ì¸ì¦</h3>
            
            <div id="password-setup" class="hidden">
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center;">
                    <strong>ğŸ”‘ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”</strong><br>
                    <small>4ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”</small>
                </div>
                
                <div class="mb-2">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                    <input id="new-password" type="password" class="input" placeholder="1234" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
                
                <div class="mb-2">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input id="confirm-password" type="password" class="input" placeholder="1234" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
            </div>

            <div id="password-verify">
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center;">
                    <strong>ğŸ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</strong>
                </div>
                
                <div class="mb-2">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ë¹„ë°€ë²ˆí˜¸</label>
                    <input id="verify-password" type="password" class="input" placeholder="â€¢â€¢â€¢â€¢" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
                
                <div class="text-center mb-2">
                    <button id="forgot-password" class="btn btn-small btn-secondary">
                        ğŸ”„ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •
                    </button>
                </div>
            </div>

            <div id="password-error" class="hidden" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.5rem; padding: 0.5rem; margin-bottom: 1rem; text-align: center; color: #991b1b;">
                âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
            </div>
            
            <div class="flex gap-3">
                <button id="password-confirm" class="btn btn-primary" style="flex: 1;" disabled>
                    ğŸ”“ í™•ì¸
                </button>
                <button id="password-cancel" class="btn btn-secondary" style="flex: 1;">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <!-- ê³µìœ  ëª¨ë‹¬ -->
    <div id="share-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-center mb-2">ğŸ”— ì°¸ê°€ì ë§í¬ ê³µìœ </h3>
            
            <div class="mb-2">
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ê²Œì„ ë£¸ ì½”ë“œ</label>
                <div class="flex gap-2">
                    <div id="share-room-code" class="room-code" style="flex: 1; text-align: center; padding: 0.75rem; font-size: 1.25rem;">ABC123</div>
                    <button id="copy-room" class="btn btn-small btn-secondary">ğŸ“‹</button>
                </div>
            </div>
            
            <div class="mb-2">
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ì°¸ê°€ì ì „ìš© ë§í¬</label>
                <div id="share-url" style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem; font-size: 0.75rem; word-break: break-all; max-height: 4rem; overflow-y: auto; border: 1px solid #e2e8f0;">
                    https://example.com/?room=ABC123&mode=player
                </div>
            </div>
            
            <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; text-align: center;">
                ğŸ’¡ ì´ ë§í¬ë¡œ ì ‘ì†í•˜ë©´ ìë™ìœ¼ë¡œ ì°¸ê°€ì ëª¨ë“œë¡œ ì…ì¥ë©ë‹ˆë‹¤
            </div>
            
            <div class="flex gap-3">
                <button id="share-link" class="btn btn-primary" style="flex: 1;">
                    ğŸ“± ë§í¬ ê³µìœ 
                </button>
                <button id="close-share" class="btn btn-secondary" style="flex: 1;">
                    ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <div class="footer">
        ğŸ“š Made by <strong>2025 ì‚¬ëŒ€ë„í˜‘ ì‚¬ë¬´êµ­</strong>
    </div>

    <script>
        // KDC ì£¼ì œ ë°ì´í„°
        const KDC_TOPICS = [
            'ë„ì„œê´€í•™', 'ì •ë³´í•™', 'ë°±ê³¼ì‚¬ì „', 'ë…¼ë¬¸ì‘ì„±ë²•', 'ì»´í“¨í„°ê³¼í•™', 'ì¸í„°ë„·', 'ì €ë„ë¦¬ì¦˜', 'ì‹ ë¬¸í•™', 'ì¡ì§€í•™', 'ì¶œíŒí•™',
            'í˜•ì´ìƒí•™', 'ì¸ì‹ë¡ ', 'ë…¼ë¦¬í•™', 'ìœ¤ë¦¬í•™', 'ë¯¸í•™', 'ì‹¬ë¦¬í•™', 'ì² í•™ì‚¬', 'ë™ì–‘ì² í•™', 'ì„œì–‘ì² í•™', 'ì¢…êµì² í•™',
            'ê¸°ë…êµ', 'ë¶ˆêµ', 'ì´ìŠ¬ëŒêµ', 'íŒë‘êµ', 'ìœ êµ', 'ë„êµ', 'ì‹ í™”í•™', 'ì¢…êµì‚¬', 'ì¢…êµì² í•™', 'ì¢…êµë¬¸í™”',
            'ì‚¬íšŒí•™', 'ì •ì¹˜í•™', 'í–‰ì •í•™', 'ë²•í•™', 'ê²½ì œí•™', 'í†µê³„í•™', 'êµìœ¡í•™', 'ë¯¼ì†í•™', 'êµ­ë°©í•™', 'ì‚¬íšŒë¬¸ì œ',
            'ìˆ˜í•™', 'ë¬¼ë¦¬í•™', 'í™”í•™', 'ìƒë¬¼í•™', 'ì§€êµ¬ê³¼í•™', 'ì²œë¬¸í•™', 'ê¸°ìƒí•™', 'ì§€ì§ˆí•™', 'ìƒíƒœí•™', 'í™˜ê²½ê³¼í•™',
            'ì˜í•™', 'ê³µí•™', 'ë†í•™', 'ê±´ì¶•í•™', 'ê¸°ê³„ê³µí•™', 'ì „ìê³µí•™', 'ì»´í“¨í„°ê³µí•™', 'í™”í•™ê³µí•™', 'í† ëª©ê³µí•™', 'ì‚°ì—…ê³µí•™',
            'ë¯¸ìˆ ', 'ì¡°ê°', 'ê³µì˜ˆ', 'ì„œì˜ˆ', 'íšŒí™”', 'ê±´ì¶•ì˜ˆìˆ ', 'ì‚¬ì§„', 'ìŒì•…', 'ë¬´ìš©', 'ì—°ê·¹',
            'ì–¸ì–´í•™', 'í•œêµ­ì–´', 'ì¤‘êµ­ì–´', 'ì¼ë³¸ì–´', 'ì˜ì–´', 'ë…ì¼ì–´', 'í”„ë‘ìŠ¤ì–´', 'ìŠ¤í˜ì¸ì–´', 'ëŸ¬ì‹œì•„ì–´', 'ì•„ëì–´',
            'ë¬¸í•™ì´ë¡ ', 'í•œêµ­ë¬¸í•™', 'ì¤‘êµ­ë¬¸í•™', 'ì¼ë³¸ë¬¸í•™', 'ì˜ë¯¸ë¬¸í•™', 'ë…ì¼ë¬¸í•™', 'í”„ë‘ìŠ¤ë¬¸í•™', 'ì‹œë¬¸í•™', 'ì†Œì„¤', 'í¬ê³¡',
            'ì—­ì‚¬í•™', 'í•œêµ­ì‚¬', 'ë™ì–‘ì‚¬', 'ì„œì–‘ì‚¬', 'ì„¸ê³„ì‚¬', 'ê³ ê³ í•™', 'ì „ê¸°', 'ì§€ë¦¬í•™', 'ì—¬í–‰ê¸°', 'ë¬¸í™”ì‚¬'
        ];

        // ê²Œì„ ìƒíƒœ ê´€ë¦¬
        class BingoGame {
            constructor() {
                this.gameRoom = '';
                this.gameMode = 'select';
                this.gameState = 'waiting';
                this.calledTopics = [];
                this.currentTopic = '';
                this.players = new Map();
                this.playerId = '';
                this.playerName = '';
                this.playerCard = [];
                this.requiredBingoLines = 3;
                this.isSharedLink = false;
                this.lastUpdate = Date.now();
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadGameState();
                this.startSync();
                this.checkConnection();
                this.hideLoading();
            }

            hideLoading() {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
            }

            setupEventListeners() {
                // ë©”ì¸ ë²„íŠ¼ë“¤
                document.getElementById('admin-mode-btn').addEventListener('click', () => this.showPasswordModal());
                document.getElementById('join-game-btn').addEventListener('click', () => this.joinAsPlayer());
                document.getElementById('share-game-btn').addEventListener('click', () => this.showShareModal());
                document.getElementById('refresh-btn').addEventListener('click', () => this.refreshGame());
                
                // í”Œë ˆì´ì–´ ì´ë¦„ ì…ë ¥
                const nameInput = document.getElementById('player-name-input');
                nameInput.addEventListener('input', (e) => {
                    document.getElementById('join-game-btn').disabled = !e.target.value.trim();
                });
                nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && e.target.value.trim()) this.joinAsPlayer();
                });

                // ê´€ë¦¬ì ë²„íŠ¼ë“¤
                document.getElementById('back-to-main').addEventListener('click', () => this.showScreen('select'));
                document.getElementById('share-admin-btn').addEventListener('click', () => this.showShareModal());
                document.getElementById('change-password-btn').addEventListener('click', () => this.changePassword());
                document.getElementById('game-toggle').addEventListener('click', () => this.toggleGame());
                document.getElementById('reset-game').addEventListener('click', () => this.resetGame());
                document.getElementById('call-topic').addEventListener('click', () => this.callTopic());

                // í”Œë ˆì´ì–´ ë²„íŠ¼ë“¤
                document.getElementById('player-back').addEventListener('click', () => this.showScreen('select'));
                document.getElementById('player-refresh').addEventListener('click', () => this.refreshGame());

                // ë¹™ê³  ë¼ì¸ ì„¤ì •
                const rangeInput = document.getElementById('bingo-range');
                rangeInput.addEventListener('input', (e) => {
                    this.setRequiredLines(parseInt(e.target.value));
                });

                // ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬
                document.getElementById('password-confirm').addEventListener('click', () => this.confirmPassword());
                document.getElementById('password-cancel').addEventListener('click', () => this.hidePasswordModal());
                document.getElementById('forgot-password').addEventListener('click', () => this.resetPassword());

                // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œë“¤
                ['new-password', 'confirm-password', 'verify-password'].forEach(id => {
                    const input = document.getElementById(id);
                    input.addEventListener('input', (e) => {
                        e.target.value = e.target.value.replace(/[^0-9]/g, '');
                        this.validatePassword();
                    });
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.confirmPassword();
                    });
                });

                // ê³µìœ  ëª¨ë‹¬
                document.getElementById('copy-room').addEventListener('click', () => this.copyText(this.gameRoom));
                document.getElementById('share-link').addEventListener('click', () => this.shareLink());
                document.getElementById('close-share').addEventListener('click', () => this.hideShareModal());
            }

            loadGameState() {
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                const mode = urlParams.get('mode');
                
                if (roomId) {
                    this.gameRoom = roomId;
                    if (mode === 'player') {
                        this.isSharedLink = true;
                        document.getElementById('admin-mode-btn').classList.add('hidden');
                        document.getElementById('shared-notice').classList.remove('hidden');
                        document.getElementById('share-game-btn').classList.add('hidden');
                        document.getElementById('usage-text').innerHTML = 
                            'â€¢ ì´ë¯¸ ì„¤ì •ëœ ê²Œì„ì— ì°¸ê°€ìë¡œ ì…ì¥í•©ë‹ˆë‹¤<br>' +
                            'â€¢ ì´ë¦„ì„ ì…ë ¥í•˜ê³  ê²Œì„ì— ì°¸ì—¬í•˜ì„¸ìš”<br>' +
                            'â€¢ ê´€ë¦¬ìê°€ ì£¼ì œë¥¼ í˜¸ì¶œí•˜ë©´ ìë™ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤<br>' +
                            'â€¢ ì„¤ì •ëœ ì¤„ ìˆ˜ë¥¼ ì™„ì„±í•˜ë©´ ë¹™ê³ ì…ë‹ˆë‹¤';
                    }
                    
                    // ì €ì¥ëœ ìƒíƒœ ë¡œë“œ
                    const saved = this.loadSavedState(roomId);
                    if (saved) this.restoreState(saved);
                } else {
                    this.gameRoom = this.generateRoomId();
                    this.updateUrl();
                }
                
                this.updateUI();
            }

            generateRoomId() {
                return Math.random().toString(36).substr(2, 8).toUpperCase();
            }

            updateUrl() {
                const params = new URLSearchParams();
                params.set('room', this.gameRoom);
                if (this.isSharedLink) params.set('mode', 'player');
                window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);
            }

            loadSavedState(roomId) {
                try {
                    const saved = localStorage.getItem(`kdc-bingo-${roomId}`);
                    if (saved) {
                        const data = JSON.parse(saved);
                        if (Date.now() - data.lastUpdate < 24 * 60 * 60 * 1000) {
                            return data;
                        }
                    }
                } catch (e) {}
                return null;
            }

            saveState() {
                try {
                    const state = {
                        calledTopics: this.calledTopics,
                        currentTopic: this.currentTopic,
                        gameState: this.gameState,
                        requiredBingoLines: this.requiredBingoLines,
                        players: Array.from(this.players.entries()),
                        lastUpdate: Date.now()
                    };
                    localStorage.setItem(`kdc-bingo-${this.gameRoom}`, JSON.stringify(state));
                } catch (e) {}
            }

            restoreState(saved) {
                if (saved.calledTopics) this.calledTopics = saved.calledTopics;
                if (saved.currentTopic) this.currentTopic = saved.currentTopic;
                if (saved.gameState) this.gameState = saved.gameState;
                if (saved.requiredBingoLines) this.requiredBingoLines = saved.requiredBingoLines;
                if (saved.players) this.players = new Map(saved.players);
                this.lastUpdate = saved.lastUpdate || Date.now();
            }

            startSync() {
                setInterval(() => {
                    this.saveState();
                    this.loadRemoteState();
                    this.updateUI();
                }, 2000);
            }

            loadRemoteState() {
                const saved = this.loadSavedState(this.gameRoom);
                if (saved && saved.lastUpdate > this.lastUpdate) {
                    this.restoreState(saved);
                    this.updatePlayerCard();
                }
            }

            checkConnection() {
                setInterval(() => {
                    const online = navigator.onLine;
                    document.querySelectorAll('[id$="connection"]').forEach(el => {
                        el.className = `status-badge ${online ? 'status-online' : 'status-offline'}`;
                        el.textContent = online ? 'ğŸŒ ì‹¤ì‹œê°„ ì—°ê²°' : 'ğŸ“µ ì˜¤í”„ë¼ì¸';
                    });
                }, 3000);
            }

            showScreen(screen) {
                ['select-screen', 'admin-screen', 'player-screen'].forEach(id => {
                    document.getElementById(id).classList.add('hidden');
                });
                document.getElementById(`${screen}-screen`).classList.remove('hidden');
                this.gameMode = screen;
                this.updateUI();
            }

            // ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬
            showPasswordModal() {
                const hasPassword = this.hasPassword();
                document.getElementById('password-setup').classList.toggle('hidden', hasPassword);
                document.getElementById('password-verify').classList.toggle('hidden', !hasPassword);
                this.clearPasswordInputs();
                document.getElementById('password-modal').classList.remove('hidden');
                
                if (hasPassword) {
                    document.getElementById('verify-password').focus();
                } else {
                    document.getElementById('new-password').focus();
                }
            }

            hidePasswordModal() {
                document.getElementById('password-modal').classList.add('hidden');
                this.clearPasswordInputs();
                this.hidePasswordError();
            }

            hasPassword() {
                return localStorage.getItem(`admin-pwd-${this.gameRoom}`) !== null;
            }

            savePassword(password) {
                const hash = btoa(password + this.gameRoom);
                localStorage.setItem(`admin-pwd-${this.gameRoom}`, hash);
            }

            verifyPassword(password) {
                const stored = localStorage.getItem(`admin-pwd-${this.gameRoom}`);
                const hash = btoa(password + this.gameRoom);
                return stored === hash;
            }

            confirmPassword() {
                const hasPassword = this.hasPassword();
                
                if (hasPassword) {
                    const password = document.getElementById('verify-password').value;
                    if (this.verifyPassword(password)) {
                        this.hidePasswordModal();
                        this.showScreen('admin');
                    } else {
                        this.showPasswordError('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
                    }
                } else {
                    const newPwd = document.getElementById('new-password').value;
                    const confirmPwd = document.getElementById('confirm-password').value;
                    
                    if (newPwd.length !== 4) {
                        this.showPasswordError('4ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    
                    if (newPwd !== confirmPwd) {
                        this.showPasswordError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                        return;
                    }
                    
                    this.savePassword(newPwd);
                    this.hidePasswordModal();
                    this.showScreen('admin');
                    alert('ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
            }

            validatePassword() {
                const hasPassword = this.hasPassword();
                const confirmBtn = document.getElementById('password-confirm');
                
                if (hasPassword) {
                    const password = document.getElementById('verify-password').value;
                    confirmBtn.disabled = password.length !== 4;
                    confirmBtn.textContent = 'ğŸ”“ ë¡œê·¸ì¸';
                } else {
                    const newPwd = document.getElementById('new-password').value;
                    const confirmPwd = document.getElementById('confirm-password').value;
                    const valid = newPwd.length === 4 && confirmPwd.length === 4;
                    
                    confirmBtn.disabled = !valid;
                    confirmBtn.textContent = 'ğŸ” ë¹„ë°€ë²ˆí˜¸ ì„¤ì •';
                    
                    if (valid && newPwd !== confirmPwd) {
                        this.showPasswordError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                    } else {
                        this.hidePasswordError();
                    }
                }
            }

            showPasswordError(msg) {
                const errorEl = document.getElementById('password-error');
                errorEl.textContent = `âŒ ${msg}`;
                errorEl.classList.remove('hidden');
            }

            hidePasswordError() {
                document.getElementById('password-error').classList.add('hidden');
            }

            clearPasswordInputs() {
                ['new-password', 'confirm-password', 'verify-password'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                this.validatePassword();
            }

            changePassword() {
                if (confirm('ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    localStorage.removeItem(`admin-pwd-${this.gameRoom}`);
                    this.showPasswordModal();
                }
            }

            resetPassword() {
                if (confirm('ğŸ”„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    localStorage.removeItem(`admin-pwd-${this.gameRoom}`);
                    this.hidePasswordModal();
                    this.showPasswordModal();
                }
            }

            // ê³µìœ  ê¸°ëŠ¥
            showShareModal() {
                document.getElementById('share-room-code').textContent = this.gameRoom;
                document.getElementById('share-url').textContent = 
                    `${window.location.origin}${window.location.pathname}?room=${this.gameRoom}&mode=player`;
                document.getElementById('share-modal').classList.remove('hidden');
            }

            hideShareModal() {
                document.getElementById('share-modal').classList.add('hidden');
            }

            shareLink() {
                const url = `${window.location.origin}${window.location.pathname}?room=${this.gameRoom}&mode=player`;
                if (navigator.share) {
                    navigator.share({
                        title: 'ğŸ“š KDC ë„ì„œê´€ ë¹™ê³  ê²Œì„',
                        text: 'í•¨ê»˜ ë¹™ê³  ê²Œì„ì— ì°¸ì—¬í•˜ì„¸ìš”!',
                        url: url
                    }).catch(() => this.copyText(url));
                } else {
                    this.copyText(url);
                }
            }

            copyText(text) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        alert('ğŸ”— í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    }).catch(() => this.fallbackCopy(text));
                } else {
                    this.fallbackCopy(text);
                }
            }

            fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    if (document.execCommand('copy')) {
                        alert('ğŸ”— í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        prompt('ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:', text);
                    }
                } catch (e) {
                    prompt('ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:', text);
                }
                
                document.body.removeChild(textArea);
            }

            // ê²Œì„ ë¡œì§
            joinAsPlayer() {
                const name = document.getElementById('player-name-input').value.trim();
                if (!name) return;
                
                this.playerName = name;
                this.playerId = `player_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`;
                this.playerCard = this.generateBingoCard();
                this.playerCard[12].marked = true; // ê°€ìš´ë° FREE
                
                // ì´ë¯¸ í˜¸ì¶œëœ ì£¼ì œ ë§ˆí‚¹
                this.calledTopics.forEach(topic => {
                    this.playerCard.forEach(cell => {
                        if (cell.topic === topic) cell.marked = true;
                    });
                });

                this.players.set(this.playerId, {
                    name: this.playerName,
                    card: this.playerCard,
                    bingoLines: this.checkBingo(this.playerCard),
                    joinTime: Date.now()
                });
                
                this.showScreen('player');
                this.saveState();
            }

            generateBingoCard() {
                const shuffled = [...KDC_TOPICS].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, 25).map((topic, index) => ({
                    id: index,
                    topic,
                    marked: false,
                    isCenter: index === 12
                }));
            }

            checkBingo(card) {
                const grid = [];
                for (let i = 0; i < 5; i++) {
                    grid.push(card.slice(i * 5, (i + 1) * 5));
                }

                let count = 0;
                
                // ê°€ë¡œì¤„
                for (let i = 0; i < 5; i++) {
                    if (grid[i].every(cell => cell.marked)) count++;
                }
                
                // ì„¸ë¡œì¤„
                for (let j = 0; j < 5; j++) {
                    if (grid.every(row => row[j].marked)) count++;
                }
                
                // ëŒ€ê°ì„ 
                if (grid.every((row, i) => row[i].marked)) count++;
                if (grid.every((row, i) => row[4 - i].marked)) count++;
                
                return count;
            }

            isBingoComplete(lines) {
                return lines >= this.requiredBingoLines;
            }

            toggleGame() {
                this.gameState = this.gameState === 'playing' ? 'paused' : 'playing';
                this.saveState();
                this.updateUI();
            }

            resetGame() {
                if (confirm('ğŸ”„ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.calledTopics = [];
                    this.currentTopic = '';
                    this.gameState = 'waiting';
                    this.players.clear();
                    this.requiredBingoLines = 3;
                    localStorage.removeItem(`kdc-bingo-${this.gameRoom}`);
                    this.updateUI();
                }
            }

            callTopic() {
                const uncalled = KDC_TOPICS.filter(topic => !this.calledTopics.includes(topic));
                if (uncalled.length === 0) return;

                const topic = uncalled[Math.floor(Math.random() * uncalled.length)];
                this.currentTopic = topic;
                this.calledTopics.push(topic);
                this.lastUpdate = Date.now();
                
                // ëª¨ë“  í”Œë ˆì´ì–´ ì¹´ë“œ ì—…ë°ì´íŠ¸
                this.players.forEach((player, id) => {
                    const updatedCard = player.card.map(cell => 
                        cell.topic === topic ? { ...cell, marked: true } : cell
                    );
                    this.players.set(id, {
                        ...player,
                        card: updatedCard,
                        bingoLines: this.checkBingo(updatedCard)
                    });
                });

                this.updatePlayerCard();
                this.saveState();
                this.updateUI();
            }

            updatePlayerCard() {
                if (this.gameMode === 'player' && this.playerId) {
                    this.playerCard = this.playerCard.map(cell => 
                        this.calledTopics.includes(cell.topic) ? { ...cell, marked: true } : cell
                    );
                    
                    if (this.players.has(this.playerId)) {
                        const player = this.players.get(this.playerId);
                        player.card = this.playerCard;
                        player.bingoLines = this.checkBingo(this.playerCard);
                        this.players.set(this.playerId, player);
                    }
                }
            }

            setRequiredLines(lines) {
                if (this.gameState === 'playing' && this.calledTopics.length > 0) return;
                this.requiredBingoLines = lines;
                this.saveState();
                this.updateUI();
            }

            refreshGame() {
                this.loadRemoteState();
                this.updateUI();
            }

            getLeaderboard() {
                return Array.from(this.players.entries())
                    .map(([id, player]) => ({ id, ...player }))
                    .sort((a, b) => {
                        if (b.bingoLines !== a.bingoLines) return b.bingoLines - a.bingoLines;
                        return a.joinTime - b.joinTime; // ê°™ì€ ì¤„ ìˆ˜ë©´ ë¨¼ì € ì°¸ì—¬í•œ ì‚¬ëŒì´ ì•ì„œ
                    });
            }

            updateUI() {
                this.updateRoomInfo();
                this.updateStats();
                this.updateGameControls();
                this.updateCurrentTopic();
                this.updateLeaderboard();
                this.updateBingoCard();
                this.updatePlayerStatus();
            }

            updateRoomInfo() {
                document.querySelectorAll('[id*="room-code"]').forEach(el => {
                    el.textContent = this.gameRoom;
                });
            }

            updateStats() {
                const playerCount = this.players.size;
                const topicCount = this.calledTopics.length;
                
                document.getElementById('total-players').textContent = playerCount;
                document.getElementById('called-topics').textContent = topicCount;
                document.getElementById('admin-players').textContent = playerCount;
                document.getElementById('admin-topics').textContent = topicCount;
                document.getElementById('admin-condition').textContent = this.requiredBingoLines;
                document.getElementById('admin-completed').textContent = 
                    this.getLeaderboard().filter(p => this.isBingoComplete(p.bingoLines)).length;
                document.getElementById('rank-count').textContent = playerCount;
            }

            updateGameControls() {
                if (this.gameMode !== 'admin') return;

                const toggleBtn = document.getElementById('game-toggle');
                const callBtn = document.getElementById('call-topic');
                const rangeInput = document.getElementById('bingo-range');
                const rangeValue = document.getElementById('bingo-value');
                const rangeWarning = document.getElementById('range-warning');

                // ê²Œì„ í† ê¸€ ë²„íŠ¼
                if (this.gameState === 'playing') {
                    toggleBtn.textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
                    toggleBtn.className = 'btn btn-warning';
                } else {
                    toggleBtn.textContent = 'â–¶ï¸ ê²Œì„ ì‹œì‘';
                    toggleBtn.className = 'btn btn-success';
                }

                // ì£¼ì œ í˜¸ì¶œ ë²„íŠ¼
                const remaining = KDC_TOPICS.length - this.calledTopics.length;
                callBtn.textContent = `ğŸ“¢ ë‹¤ìŒ ì£¼ì œ í˜¸ì¶œ (${remaining}ê°œ ë‚¨ìŒ)`;
                callBtn.disabled = this.gameState !== 'playing' || remaining === 0;

                // ë¹™ê³  ë¼ì¸ ì„¤ì •
                rangeInput.value = this.requiredBingoLines;
                rangeValue.textContent = this.requiredBingoLines;
                
                const gameActive = this.gameState === 'playing' && this.calledTopics.length > 0;
                rangeInput.disabled = gameActive;
                rangeWarning.classList.toggle('hidden', !gameActive);
            }

            updateCurrentTopic() {
                const displays = [
                    { card: 'current-topic-card', name: 'current-topic-name', time: 'current-topic-time' },
                    { card: 'player-current-topic', name: 'player-topic-name', time: 'player-topic-time' }
                ];

                displays.forEach(({ card, name, time }) => {
                    const cardEl = document.getElementById(card);
                    if (this.currentTopic) {
                        document.getElementById(name).textContent = this.currentTopic;
                        document.getElementById(time).textContent = 'ë°©ê¸ˆ í˜¸ì¶œë¨';
                        cardEl.classList.remove('hidden');
                    } else {
                        cardEl.classList.add('hidden');
                    }
                });

                // ì£¼ì œ íˆìŠ¤í† ë¦¬
                const historyEl = document.getElementById('topics-history');
                if (this.calledTopics.length === 0) {
                    historyEl.innerHTML = '<div style="text-align: center; color: #64748b; padding: 1rem;">ì•„ì§ í˜¸ì¶œëœ ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                } else {
                    historyEl.innerHTML = [...this.calledTopics].reverse().slice(0, 10).map((topic, index) => 
                        `<div style="padding: 0.25rem 0; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between;">
                            <span>${topic}</span>
                            <span style="color: #94a3b8;">#${this.calledTopics.length - index}</span>
                        </div>`
                    ).join('');
                }
            }

            updateLeaderboard() {
                const leaderboard = this.getLeaderboard();
                const containers = ['admin-leaderboard', 'player-leaderboard'];

                containers.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (!container) return;

                    if (leaderboard.length === 0) {
                        container.innerHTML = `<div style="text-align: center; padding: 2rem; color: #64748b;">
                            ğŸ‘¥ ${containerId.includes('player') ? 'ë‹¤ë¥¸ ì°¸ê°€ìê°€' : 'ì°¸ê°€ìê°€'} ì—†ìŠµë‹ˆë‹¤
                        </div>`;
                        return;
                    }

                    container.innerHTML = leaderboard.map((player, index) => {
                        const isCurrentPlayer = player.id === this.playerId;
                        const isComplete = this.isBingoComplete(player.bingoLines);
                        
                        let rankClass = 'rank-other';
                        let emoji = '';
                        let itemClass = 'player-item';
                        
                        if (index === 0) {
                            rankClass = 'rank-1';
                            emoji = 'ğŸ‘‘';
                        } else if (index === 1) {
                            rankClass = 'rank-2';
                            emoji = 'ğŸ¥ˆ';
                        } else if (index === 2) {
                            rankClass = 'rank-3';
                            emoji = 'ğŸ¥‰';
                        }
                        
                        if (isCurrentPlayer) itemClass += ' player-current';

                        return `
                            <div class="${itemClass}">
                                <div class="player-info">
                                    <div class="player-rank ${rankClass}">${index + 1}</div>
                                    <div>
                                        <div style="font-weight: 600; display: flex; align-items: center; gap: 0.25rem;">
                                            ${player.name}
                                            ${isCurrentPlayer ? '<span style="color: #10b981;">ğŸ‘¤</span>' : ''}
                                        </div>
                                        <div style="font-size: 0.875rem; color: #64748b;">
                                            ${player.bingoLines}ì¤„ ì™„ì„±
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    ${emoji ? `<div style="font-size: 1.25rem; margin-bottom: 0.25rem;">${emoji}</div>` : ''}
                                    ${isComplete ? '<div class="bingo-badge">âœ… BINGO!</div>' : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                });
            }

            updateBingoCard() {
                if (this.gameMode !== 'player' || !this.playerCard.length) return;

                const container = document.getElementById('player-bingo-card');
                container.innerHTML = this.playerCard.map(cell => {
                    let cellClass = 'bingo-cell';
                    let content = cell.topic;
                    
                    if (cell.isCenter) {
                        cellClass += ' center';
                        content = '<div style="font-size: 0.875rem;">â­</div><div style="font-size: 0.625rem;">FREE</div>';
                    } else if (cell.marked) {
                        cellClass += ' marked';
                    }
                    
                    return `<div class="${cellClass}">${content}</div>`;
                }).join('');
            }

            updatePlayerStatus() {
                if (this.gameMode !== 'player') return;

                document.getElementById('player-title').textContent = `ğŸ¯ ${this.playerName}ë‹˜ì˜ ë¹™ê³ `;
                document.getElementById('my-condition').textContent = this.requiredBingoLines;
                document.getElementById('my-progress').textContent = `(${this.calledTopics.length}ê°œ í˜¸ì¶œ)`;

                if (this.playerId && this.players.has(this.playerId)) {
                    const player = this.players.get(this.playerId);
                    const leaderboard = this.getLeaderboard();
                    const rank = leaderboard.findIndex(p => p.id === this.playerId) + 1;
                    const isComplete = this.isBingoComplete(player.bingoLines);

                    document.getElementById('my-lines').textContent = player.bingoLines;
                    document.getElementById('my-lines').style.color = isComplete ? '#ef4444' : '#3b82f6';
                    document.getElementById('my-rank').textContent = rank ? `#${rank}` : '#-';
                    
                    document.getElementById('my-bingo-status').classList.toggle('hidden', !isComplete);
                    
                    const medal = document.getElementById('my-medal');
                    if (rank === 1) medal.textContent = 'ğŸ‘‘';
                    else if (rank === 2) medal.textContent = 'ğŸ¥ˆ';
                    else if (rank === 3) medal.textContent = 'ğŸ¥‰';
                    else medal.textContent = '';
                }
            }
        }

        // ì•± ì‹œì‘
        document.addEventListener('DOMContentLoaded', () => {
            new BingoGame();
        });
    </script>
</body>
</html>
